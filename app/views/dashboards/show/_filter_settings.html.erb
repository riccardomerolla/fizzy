<%= tag.aside \
      class: class_names("filters margin-block-end", { "filters--expanded": user_filtering.expanded? }),
      data: {
        controller: "toggle-enable toggle-class",
        toggle_class_toggle_class: "filters--expanded",
        turbo_permanent: true } do %>
  <%= form_with url: filter_url, method: :get, class: "display-contents", data: {
        controller: "form",
        action: "submit->form#submit" } do |form| %>
    <%= hidden_field_tag :expand_all, true, disabled: !user_filtering.expanded?, data: { toggle_enable_target: "element" } %>

    <%= form.search_field "terms[]", placeholder: "Filter these cardsâ€¦ [F]", class: "filter__terms input txt-x-small",
        autofocus: false, autocomplete: :off, autocorrect: "off", data: {
              "1p-ignore": "true",
              controller: "hotkey",
              action: "keydown.f@document->hotkey#focus input->form#debouncedSubmit keydown.enter->form#submit blur->form#submit" } %>

    <%= form.select :site_id,
        options_for_select([["All Sites", ""]] + sites.map { |s| [s.name, s.id] }, selected_site&.id),
        {},
        class: "btn input input--select txt-x-small filters__show-when-expanded",
        style: "#{selected_site.present? ? '--input-background: var(--color-selected);' : ''} max-width: 12em;",
        data: { action: "change->form#submit" } %>

    <%= form.date_field :start_date,
        value: start_date.to_date,
        placeholder: "Start date",
        class: "btn input input--select txt-x-small filters__show-when-expanded",
        style: "max-width: 10em;",
        data: { action: "change->form#submit" } %>

    <%= form.date_field :end_date,
        value: end_date.to_date,
        placeholder: "End date",
        class: "btn input input--select txt-x-small filters__show-when-expanded",
        style: "max-width: 10em;",
        data: { action: "change->form#submit" } %>

    <%= render "filters/settings/toggle", user_filtering: user_filtering %>
  <% end %>
<% end %>
